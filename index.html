<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insta Monitor</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>body{padding:20px;max-width:800px;margin:0 auto;font-family:sans-serif;}</style>
</head>
<body>
    <h2 style="text-align:center">Instagram 監視グラフ</h2>
    <div style="text-align:center; margin-bottom: 20px;">
        最新フォロワー: <strong id="val-fol">-</strong> / 
        投稿: <strong id="val-post">-</strong>
        <br><small id="last-update"></small>
    </div>
    <canvas id="chart"></canvas>
    <script>
        async function draw() {
            const res = await fetch('data.json?t=' + Date.now());
            const data = await res.json();
            if(!data.length) return;

            const last = data[data.length - 1];
            document.getElementById('val-fol').innerText = last.followers;
            document.getElementById('val-post').innerText = last.posts;
            document.getElementById('last-update').innerText = "更新: " + last.timestamp;

            new Chart(document.getElementById('chart'), {
                type: 'line',
                data: {
                    labels: data.map(d => d.timestamp.slice(5)), 
                    datasets: [{
                        label: 'フォロワー',
                        data: data.map(d => d.followers),
                        borderColor: '#E1306C',
                        yAxisID: 'y'
                    }, {
                        label: '投稿数',
                        data: data.map(d => d.posts),
                        borderColor: '#3797EF',
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    scales: {
                        y: { position: 'left' },
                        y1: { position: 'right', grid: { drawOnChartArea: false } }
                    }
                }
            });
        }
        draw();
    </script>
</body>
</html>
